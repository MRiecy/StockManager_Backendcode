# 会议前问题清单



## 1. 取消登录，改为“直填配置”的方案

- 目标：移除登录页面，改为通过配置提供“寸头账号”“会员 token”“VIP 站点列表（ADDR_LIST）”。
- 可行性：后端 `settings.XT_CONFIG` 已支持 `TOKEN`、`ADDR_LIST`、`PORT`；`apps/*/apps.py` 会在 `AppConfig.ready()` 初始化 xtdatacenter。
- 变更建议：
  - 前端：移除/隐藏登录页；在“设置/配置”页提供只读或可编辑的 `account_id`、`token`、`addr_list`；保存后由后端安全存储（更推荐后端仅读环境变量）。
  - 后端：通过环境变量覆盖 `XT_CONFIG`；如需前端下发，新增仅内网可用的 `POST /api/admin/xt-config/`，不落盘明文。
- 风险：token 安全、配置热更新（需重连 xtdatacenter）、连接状态 UI 展示。

截图占位：
- 登录报错提示（用户名和密码不能为空） — 放置于 `docs/images/shot-01-login-error.png`

## 2. 登录问题

- 后端：`POST /api/auth/login/`（`apps/account/auth_views.py::login`），参数 `username`、`password`；返回 JWT。
- 现状：图表接口多未强制鉴权，未登录也能看到图（或前端用 mock）。
- 问题：
  - 前端未正确传参导致 400；
  - 图表访问未与登录态绑定；
  - Token 未带入后续请求。

![image-20250909214611369](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20250909214611369.png)

![image-20250909214633238](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20250909214633238.png)

- 浏览器控制台/网络面板中的登录请求与响应 — `docs/images/shot-02-network-login.png`

## 3. 对比评估页面图表

- 后端接口（`apps/Comparison/views.py`）：
  - `weekly_comparison`：`xtdata.get_market_data` 拉近6周日线 → 按周聚合收益率 → 返回 `weekly_data`。
  - `yearly_comparison`：当前可能仍为固定年度；建议改为“近三年（当年截至今天）”。
  - `area_comparison`、`asset_comparison`：`xttrader.query_stock_positions` 拉持仓 → 简化分组（目前多为“其他”）。
- 前端现象：
  - 未登录也有图；图例出现 `110064.SH/113037.SH/501018.SH` 等，疑似前端 mock 或未接后端策略接口。
- 可能的数据路径：
  1) 前端请求后端接口 → 成功返回真实数据；
  2) 后端失败/未接入 → 前端使用本地 mock 渲染；
  3) 前端直接用 mock（未调用后端）。

![image-20250909214536801](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20250909214536801.png)
- 对比评估页“资产对比/收益率(%)”曲线 — `docs/images/shot-03-chart-asset-compare.png`
-  对比评估页“表格数据” — `docs/images/shot-04-table-asset-compare.png`
-  对比评估页“风险因子”面板 — `docs/images/shot-05-risk-panels.png`
-  QMT 户号 `40000326` 持仓界面 — `docs/images/shot-06-qmt-positions.png`

## 4. 需要会议确认与决策

- 登录改直填：是否彻底移除登录（短期）；token 存放仅后端环境变量；是否需要“热重连”接口。
- 图表数据源：所有图/表是否强制使用 XtQuant；失败时显示空态而非模拟；需要加 `IsAuthenticated` 的接口名单。
- 行业/地区映射：是否按证券代码查询真实行业/地区元数据替换“其他”。
- 年度区间：是否统一为“近三年（当年截至今天）”，并恢复之前的改动。
- 前端 mock 策略：是否移除/保留；若保留，显著标注“模拟数据”，并提供“仅显示真实数据”的开关。



